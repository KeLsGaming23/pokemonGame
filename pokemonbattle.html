<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Bootstrap Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <style>
        #main {
            position: absolute;
            top: -5%;
            left: 50%;
            transform: translate(-50%);
            height: 50vw;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .opponent-side{
            width: 20%;
        }
        .opponent-info{
            transform: translateX(80%);
        }
        .move-set-holder {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .pokemon-sprite {
            width: 90%;
            height: 90%;
        }

        .progress {
            height: 10%;
        }
        .damage-message{
            /* display: none; */
            width: 400px;
            top: 120px;
            background-color: rgba(28, 28, 28, 0.925);
            margin: auto;
            position: absolute;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 0;
            text-align: center;
            border-radius: 5px;
            color: white;
            font-size: 2em;
        }
    </style>
</head>

<body>
    <header id="header">
        <div class="container-xxl">
            <nav
                class="navbar navbar-expand-lg navigation text-info-emphasis border bg-primary border-info-subtle navbar-bg">
                <a class="navbar-brand" href="index.html">Simple Pokemon Battle</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html#home" onclick="navigate('home')">Pokedex Page</a>
                        </li>
                    </ul>
                </div>

            </nav>
        </div>
    </header>
    <main id="main" class="">
        <div class="opponent-side">
            <div class="container-xxl">
                <h3 id="opponent-pokemon"></h3>
            </div>
            <div class="progress" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0"
                aria-valuemax="100">
                <div id="opponent-progress-bar" class="progress-bar bg-success" style="width: 100%">100%</div>
            </div>
            <div id="opponent-info" class="opponent-info">

            </div>
        </div>
        <div class="player-side">
            <div class="container-xxl">
                <h3 id="player-pokemon"></h3>
            </div>
            <div class="progress" role="progressbar" aria-label="Success example"
                aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                <div id="player-progress-bar" class="progress-bar bg-success" style="width: 100%">100%</div><br>
                <div
                    class="move-set-holder border p-4  mx-2 my-2 gap-2 d-md-flex justify-content-md-center align-items-center">
                    <button id="first-moveset" class="cell btn border rounded-2 btn-lg btn-dark p-3"
                        onclick="getAttack()"></button>
                    <button id="second-moveset" class="cell btn border rounded-2 btn-lg btn-dark p-3"
                        onclick="getAttack()"></button>
                    <button id="third-moveset" class="cell btn border rounded-2 btn-lg btn-dark p-3"
                        onclick="getAttack()"></button>
                    <button id="fourth-moveset" class="cell btn border rounded-2 btn-lg btn-dark p-3"
                        onclick="getAttack()"></button>
                </div>

            </div>
            <div id="player-info" class="text-center">

            </div>
        </div>
    </main>
    <div id="damage-message" class="damage-message">
        <p>Damage Logic Here!!</p>
    </div>
    <!-- Bootstrap Script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
        crossorigin="anonymous"></script>
    <script>
        //Declare Variables
        let turnInProgress = false;

        //Select HTML Elements
        const opponentPokemonName = document.getElementById('opponent-pokemon');
        let opponentProgressBar = document.getElementById('opponent-progress-bar');
        let opponentSprite = document.getElementById('opponent-info');

        const playerPokemonName = document.getElementById('player-pokemon');
        let playerProgressBar = document.getElementById('player-progress-bar');
        let playerSprite = document.getElementById('player-info');

        const moveSetOne = document.getElementById('first-moveset');
        const moveSetTwo = document.getElementById('second-moveset');
        const moveSetThree = document.getElementById('third-moveset');
        const moveSetFour = document.getElementById('fourth-moveset');

        const damageMessage = document.getElementById('damage-message');
        damageMessage.style.display = "none";
        // Define the IDs of the two Pokemon we want to battle
        const pokemon1Id = 25; // Opponent Pokemon
        const pokemon2Id = 200;  // Player Pokemon
        // Use fetch to retrieve information about the Opponent Pokemon
        fetch(`https://pokeapi.co/api/v2/pokemon/${pokemon1Id}`)
            .then(response => response.json())
            .then(data => {
                //Variable declaration
                const pokemonName = data.name;
                opponentPokemonName.innerHTML = `${data.name}`;//Set Pokemon Name
                //Set Pokemon Sprite
                opponentSprite.innerHTML =
                    `<img alt="Rival Pokemon" class="pokemon-sprite" 
                    src="${data.sprites.front_default}">`;
            })
            .catch(error => {
                console.error(`Error retrieving Pokemon data: ${error}`);
            });

        // Use fetch to retrieve information about the Player Pokemon
        fetch(`https://pokeapi.co/api/v2/pokemon/${pokemon2Id}`)
            .then(response => response.json())
            .then(data => {
                //Variable Declaration
                const pokemonName = data.name;
                playerPokemonName.innerHTML = data.name;//Set Pokemon Name
                //Set Pokemon Sprite
                playerSprite.innerHTML =
                    `<img alt="Player Pokemon" class="pokemon-sprite" 
                    src="${data.sprites.back_default}">`;
                moveSetOne.innerText = data.moves[0].move.name;
                moveSetTwo.innerText = data.moves[1].move.name;
                moveSetThree.innerText = data.moves[2].move.name;
                moveSetFour.innerText = data.moves[3].move.name;
            })
            .catch(error => {
                console.error(`Error retrieving Pokemon data: ${error}`);
            });
        //Battle System Logic
        function getAttack() {
            if (turnInProgress) {
                return; // if it's not the player's turn, exit the function
            }

            // Set minimum and maximum damage values
            let minDamage = 5;
            let maxDamage = 20;

            // Calculate random damage within the range
            let damage = Math.floor(Math.random() * (maxDamage - minDamage + 1)) + minDamage;

            // Get the current width of the progress bar
            var currentWidth = parseInt(opponentProgressBar.style.width, 10);

            // Subtract the random damage from the current width
            var newWidth = currentWidth - damage;

            // Check if opponent HP has reached zero
            if (newWidth <= 0) {
                opponentProgressBar.style.width = "0%";
                // Opponent has been defeated
                // Add code here to handle the defeat
            } else {
                // Update the width of the progress bar
                opponentProgressBar.style.width = newWidth + "%";
                turnInProgress = true;
                setTimeout(function () {
                    damagePlayer();
                    turnInProgress = false;
                }, 700);
            }
            damageMessage.style.display = "block";
            console.log("Damage Logic Enter here");
        }
    </script>
</body>

</html>